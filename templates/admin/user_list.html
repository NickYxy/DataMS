{% extends 'base.html' %}
{% block body %}
	<!-- BEGIN PAGE BAR -->
	<div class="page-bar">
		<ul class="page-breadcrumb">
			<li>
				<a class="active" href="{{ url_for('index.index') }}">Home</a>
				<i class="fa fa-angle-right"></i>
			</li>
			<li>
				<a href="{{ url_for('manager.student') }}">学生列表</a>
			</li>
		</ul>
	</div>
	<!-- END PAGE BAR -->

	<!-- BEGIN PAGE TITLE-->
	<h1 class="page-title">
		<i class="icon-list font-green"></i>
		<span class="caption-subject font-green sbold uppercase">学生列表</span>
	</h1>
	<!-- END PAGE TITLE-->

	<a class="btn green right" data-toggle="modal" data-target="#studentAdd">新增学生
		<i class="fa fa-plus"></i>
	</a>
	<form class="navbar-form px-0" action="" method="post">
		<div class="th-col-1">
			<input type="text" class="form-control" name="name" placeholder="账号">
			<input type="text" class="form-control" name="username" placeholder="姓名">
			<button type="submit" class="btn btn-default">查询 <i class="fa fa-search"></i></button>
		</div>
	</form>

	<table id="id-student-list"
		   class="table"
		   data-toggle="table"
		   data-pagination="true"
		   data-page-size="10"
		   data-page-list="[10]">
		<thead>
		<tr>
			<th class="th-col-1" data-sortable="true">账号</th>
			<th class="th-col-1" data-sortable="true">姓名</th>
			<th class="th-col-1" data-sortable="true">电话</th>
			<th class="th-col-1" data-sortable="true">专业</th>
			<th class="th-col-1" data-sortable="true">班级</th>
			<th class="th-col-2" data-sortable="true">注册日期</th>
			<th class="th-col-2">操作</th>
		</tr>
		</thead>
		<tbody>
		{% for p in ms %}
			<tr data-id={{ p.id }}>
				<td>{{ p.name }}</td>
				<td>{{ p.username }}</td>
				<td>{{ p.mobile }}</td>
				<td>{{ p.subject }}</td>
				<td>{{ p.class_uuid | classes_name_of_uuid }}</td>
				<td>{{ p.ct | date_of_epoch }}</td>
				<td>
					<a href="javascript:" onclick="user_edit('{{ p.name }}', '{{ p.uuid }}')"
					   class="btn grey-mint btn-outline sbold btn-sm">
						<i class="fa fa-edit"></i>
						编辑
					</a>
					<a data-toggle="modal"
					   data-target="#id-user-character"
					   id="id-update"
					   class="btn green-turquoise btn-outline sbold btn-sm"
					   onclick="">
						<i class="fa fa-table"></i>
						权限列表
					</a>

					<a href="javascript:" onclick="user_del('{{ p.name }}', '{{ p.uuid }}')"
					   class="btn red-mint btn-outline sbold btn-sm">
						<i class="fa fa-trash"></i>
						删除
					</a>

				</td>
			</tr>

		{% endfor %}
		</tbody>
	</table>


	{# 新增学生 modal #}
	<div class="modal fade bs-modal-lg in" id="studentAdd" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="userAddLabel">新增学生</h4>
				</div>

				<form id="id-modal-add" method="POST" enctype="multipart/form-data"
					  action="{{ url_for('manager.student_add') }}">
					<div class="modal-body">
						<div class="row">
							<div class="col-xs-6">
								<div class="form-group form-md-line-input form-md-floating-label">
									<input class="form-control" type="text" autocomplete="off" name="name"
										   id="id-input-name" required/>
									<label for="id-input-name">账号</label>
									<span class="help-block"><span
											class="label label-sm label-danger">必填</span> </span>
								</div>
							</div>

							<div class="col-xs-6">
								<div class="form-group form-md-line-input form-md-floating-label">
									<input class="form-control" type="text" autocomplete="off" name="password"
										   id="id-input-password" required/>
									<label for="id-input-password">密码</label>
									<span class="help-block">
                                        <span class="label label-sm label-danger">必填</span> 请输入密码</span>
								</div>
							</div>
						</div>


						<div class="row">
							<div class="col-xs-12">
								<div class="form-group form-md-line-input">
									<select id="add-dep" class="form-control" name="department_uuid"
											oninput="selectDepartmentAdd()">
										<option value="" disabled selected>请选择</option>
										{% for dep in deps %}
											<option value="{{ dep.uuid }}">{{ dep.name }}</option>
										{% endfor %}
									</select>
									<label for="add-dep">院系</label>
								</div>
							</div>
						</div>

						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
							<button type="submit" class="btn btn-primary">提交</button>
						</div>
					</div>
				</form>

			</div><!-- /.modal-content -->
		</div><!-- /.modal -->
	</div>



	<script>
        let user_edit = function (name, uuid) {
            $.get(`/manager/student/${uuid}`)
                .done(function (data) {
                    let edit = $('#studentEdit')
                    $(edit.find('input[name=uuid]')).val(data.uuid)
                    $(edit.find('input[name=name]')).val(data.name)
                    $(edit.find('select[name=department_uuid]')).val(data.department_uuid)
                    edit.modal()
                })
        }
        let user_del = function (name, uuid) {
            swal({
                    title: `确定删除 "${name}" 吗？`,
                    text: "该操作无法恢复！",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "确定删除！",
                    cancelButtonText: '取消',
                    closeOnConfirm: false,
                },
                function () {
                    $.get(`/admin/student/del/${uuid}`)
                        .done(function () {
                            swal({
                                title: "成功！",
                                text: "删除：" + name,
                                type: "success",
                                timer: 600,
                            }, function () {
                                location.reload()
                            })
                        })
                        .fail(function (xhr, status, error) {
                            swal({
                                title: "错误！",
                                text: "服务器响应：" + error,
                                type: "error",
                            }, function () {
                                location.reload()
                            })
                        })
                });
        }


	</script>

{% endblock %}
